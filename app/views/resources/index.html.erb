<meta http-equiv="cache-control" content="no-cache" />
<meta http-equiv="Pragma" content="no-cache" />
<meta http-equiv="Expires" content="-1" />

<div class="top" id="resources-index">
    <h1>Resources </h1>
</div>

<%= javascript_include_tag "filter" %>

<div class="index"  id="resource-container-wrapper">
  <div id="filter-column">
    <%= form_tag("/resources.html", method: :get) do %>
      
      <div class="row">
        <div id="filter-header">
          <%= submit_tag 'Filter', class: 'btn btn-outline-dark btn-lg', id: 'filter-button'%>
        </div>
      </div>

      <div class="association" id="search_row">
        <%= label_tag(:search_bar, "Search titles and descriptions:", class: "search_bar_text") %>
        <%= text_field_tag(:search, session[:search], class: "search_bar") %>
      </div>

      <div class="association">
        <h2>Location</h2>
        <% @locations.each do |association, values| %>
          <div class="filters">
            <% values.each do |val| %>
              <div class="single_checkbox gold_label">
                <div class="label loc-radio"><%= val %></div>
                <%= radio_button_tag association, val, false, class: "radio", id: val %>
              </div>
            <% end %>
          </div>
        <% end %>
        
      </div>

      <% @has_many_hash.each do |association, values| %>
        <div class="association">
          <h2><%= association.capitalize.gsub(/[^0-9A-Za-z,\s]/, " ") %></h2>
          <div class="filters">
            <% values.each do |val| %>
              <div class="single_checkbox gold_label">
                <div class="label"><%= val %></div>
                <% if !session[association].nil? && session[association].include?(val) %>
                  <%= check_box_tag association+'[]', val, true, class: "checkbox", id: val %>
                <% else %>
                  <%= check_box_tag association+'[]', val, false, class: "checkbox", id: val %>
                <% end %>
              </div>
            <% end %>
          </div>
        </div>
      <% end %>
    <% end %>
  </div>

  <div id="resource-column">
    <% if @resources.length == 0 %>
      <div class="row">
        <div class="col-12" id = "result-header">
          <h2>No results found</h2>
        </div>
      </div>
    <% else %>
      <div class="row">
        <div class="col-12" id = "result-header">
          <h2>Results</h2>
        </div>
      </div>
      <div class="row" id="pages">
        <ul class="pagination">
          <li class="page-arrow prev disabled" id="prev">
            <p id="prevLink" class="page-link prevLink">Previous</p>
          </li>
        </ul>
      </div>

      <% @resources.each do |resource| %>
        <div class="row resource-container">
          <div class="resource-title text">
            <%= link_to(resource.title, "/resources/" + resource.id.to_s + ".html") %>
          </div>
          <div class="resource-url text">
            URL: <a href="<%= resource.url %>"><%= resource.url %></a>
          </div>
          <div class="resource-desc text">
            <% if resource.desc == nil %>
              Description: None
            <% elsif resource.desc.length > 150 %>
              Description: <%= resource.desc[0..150] + "..." %>
            <% else %>
              Description: <%= resource.desc %>
            <% end %>
            
          </div>
          <div class="resource-location text">
            Location: <%= resource.location %>
          </div>
          
          <% @type_value = resource.types.collect(&:val).to_s.gsub(/[^0-9A-Za-z,\s]/, "")%>
          <% if @type_value != "" %>
            <div class="resource-types text">
              Types: <%=  @type_value %>
            </div>
          <% end %>

          <% @audience_value = resource.audiences.collect(&:val).to_s.gsub(/[^0-9A-Za-z,\s]/, "")%>
          <% if @audience_value != "" %>
            <div class="resource-types text">
              Audiences: <%=  @audience_value %>
            </div>
          <% end %>
          

        
          <div class="text links" %>
            <%= link_to("More info", "/resources/" + resource.id.to_s + ".html", class: "btn btn-outline-primary") %>
            <% if user_signed_in? %>
              <%= link_to('Edit', edit_resource_path(resource), class: "btn btn-outline-primary") %>
            <% end %>
          </div>
        </div>
      <% end %>
      <div class="row" id="pages">
        <ul class="pagination">
          <li class="page-arrow prev disabled" id="prev">
            <p id="prevLink" class="page-link prevLink">Previous</p>
          </li>
        </ul>
      </div>
    <% end %>
    
    
  </div>
</div>
